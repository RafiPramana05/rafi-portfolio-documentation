name: Convert Markdown to PDF

on:
  push:
    branches: [ main, master ]
  workflow_dispatch: # Manual trigger

permissions:
  contents: write

jobs:
  convert-to-pdf:
    runs-on: ubuntu-22.04
    timeout-minutes: 4
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Install & Generate PDF
      run: |
        # Install packages with XeLaTeX for Unicode support + fonts
        sudo apt-get update -qq
        sudo apt-get install -y pandoc texlive-latex-base texlive-latex-recommended texlive-latex-extra texlive-xetex fonts-dejavu
        
        # Process markdown: minimal emoji replacement (XeLaTeX handles Unicode)
        sed 's/âœ…/[CHECKMARK]/g; s/ğŸš€/[ROCKET]/g; s/ğŸ“„/[DOCUMENT]/g; s/âš¡/[LIGHTNING]/g; s/ğŸ¯/[TARGET]/g; s/ğŸ“Š/[CHART]/g; s/ğŸ”„/[REFRESH]/g; s/âœ¨/[SPARKLES]/g; s/ğŸ“…/[CALENDAR]/g; s/ğŸ‰/[PARTY]/g; s/ğŸ’¡/[BULB]/g; s/ğŸ”§/[WRENCH]/g; s/ğŸ“/[FOLDER]/g; s/ğŸ·ï¸/[TAG]/g; s/ğŸ“¥/[INBOX]/g; s/ğŸ“/[MEMO]/g; s/ğŸ›ï¸/[CONTROL]/g' "DOKUMENTASI_WEBSITE_RAFI_PRAMANA_PUTRA.md" | \
        pandoc -o "Dokumentasi_Portfolio_Rafi_Pramana_Putra.pdf" \
          --pdf-engine=xelatex \
          --highlight-style=breezedark \
          --toc \
          --number-sections \
          -V geometry:margin=2.5cm \
          -V fontsize=11pt \
          -V mainfont="DejaVu Sans" \
          -V monofont="DejaVu Sans Mono" \
          -V geometry:margin=2cm \
          --metadata title="Dokumentasi Website Portfolio Rafi Pramana Putra"
          
    - uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: pdf-v${{ github.run_number }}
        name: "PDF v${{ github.run_number }}"
        body: "Auto-generated PDF documentation"
        files: Dokumentasi_Portfolio_Rafi_Pramana_Putra.pdf
