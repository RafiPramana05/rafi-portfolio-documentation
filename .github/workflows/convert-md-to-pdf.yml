name: Convert Markdown to PDF

on:
  push:
    branches: [ main, master ]
  workflow_dispatch: # Manual trigger

permissions:
  contents: write

jobs:
  convert-to-pdf:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Setup Pandoc & LaTeX (Lightning Fast)
      run: |
        # Use pre-existing packages and minimal install
        export DEBIAN_FRONTEND=noninteractive
        sudo apt-get update -qq
        sudo apt-get install -y --no-install-recommends \
          pandoc \
          texlive-latex-base \
          texlive-fonts-recommended \
          lmodern
        
    - name: Generate PDF (All-in-One)
      run: |
        # Create minimal LaTeX header
        echo '\usepackage{xcolor}
        \definecolor{codebg}{RGB}{30, 30, 30}
        \definecolor{codetext}{RGB}{212, 212, 212}
        \definecolor{keywordcolor}{RGB}{197, 134, 192}
        \definecolor{stringcolor}{RGB}{206, 145, 120}
        \definecolor{commentcolor}{RGB}{106, 153, 85}' > latex-header.tex
        
        # Process and convert in one pipeline
        sed 's/✅/[CHECKMARK]/g; s/🚀/[ROCKET]/g; s/📄/[DOCUMENT]/g; s/⚡/[LIGHTNING]/g; s/🎯/[TARGET]/g; s/📊/[CHART]/g; s/🔄/[REFRESH]/g; s/✨/[SPARKLES]/g; s/📅/[CALENDAR]/g; s/🎉/[PARTY]/g; s/💡/[BULB]/g; s/🔧/[WRENCH]/g; s/📁/[FOLDER]/g; s/🏷️/[TAG]/g; s/📥/[INBOX]/g; s/📝/[MEMO]/g; s/🎛️/[CONTROL]/g' "DOKUMENTASI_WEBSITE_RAFI_PRAMANA_PUTRA.md" | \
        pandoc -o "Dokumentasi_Portfolio_Rafi_Pramana_Putra.pdf" \
          --pdf-engine=pdflatex \
          --highlight-style=breezedark \
          --include-in-header=latex-header.tex \
          --toc \
          --toc-depth=2 \
          --number-sections \
          -V geometry:margin=2.5cm \
          -V fontsize=11pt \
          -V linestretch=1.2 \
          -V papersize=a4 \
          --metadata title="Dokumentasi Website Portfolio Rafi Pramana Putra" \
          --metadata author="Rafi Pramana Putra" \
          --metadata date="$(date +'%B %Y')"
          
    - name: Release PDF
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: pdf-v${{ github.run_number }}
        name: "Documentation PDF v${{ github.run_number }}"
        body: "[DOCUMENT] Dokumentasi Portfolio Website - PDF Version [ROCKET] Generated automatically [CALENDAR] $(date +'%Y-%m-%d %H:%M:%S UTC')"
        files: Dokumentasi_Portfolio_Rafi_Pramana_Putra.pdf
        draft: false
        prerelease: false
