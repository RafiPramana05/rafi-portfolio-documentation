% Font and language settings
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{xcolor}

% Page layout with wider margins for better code display
\usepackage{geometry}
\geometry{
    a4paper,
    left=2cm,
    right=2cm,
    top=2.5cm,
    bottom=2.5cm
}

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small DOKUMENTASI WEBSITE RAFI PRAMANA PUTRA}
\fancyhead[R]{\small \today}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Section formatting
\usepackage{titlesec}
\titleformat{\section}{\Large\bfseries\color{blue!70!black}}{\thesection}{1em}{}
\titleformat{\subsection}{\large\bfseries\color{blue!60!black}}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\bfseries\color{blue!50!black}}{\thesubsubsection}{1em}{}

% Code highlighting and formatting
\usepackage{listings}
\usepackage{fvextra}

% Define colors for syntax highlighting (dark theme)
\definecolor{codebg}{HTML}{1e1e1e}
\definecolor{codetext}{HTML}{d4d4d4}
\definecolor{codekeyword}{HTML}{569cd6}
\definecolor{codecomment}{HTML}{6a9955}
\definecolor{codestring}{HTML}{ce9178}
\definecolor{codenumber}{HTML}{b5cea8}
\definecolor{codeoperator}{HTML}{d4d4d4}

% Configure listings for code blocks with better wrapping
\lstset{
    backgroundcolor=\color{codebg},
    basicstyle=\ttfamily\scriptsize\color{codetext},
    keywordstyle=\color{codekeyword}\bfseries,
    commentstyle=\color{codecomment}\itshape,
    stringstyle=\color{codestring},
    numberstyle=\tiny\color{codenumber},
    identifierstyle=\color{codetext},
    breaklines=true,
    breakatwhitespace=true,
    showstringspaces=false,
    frame=single,
    framesep=3pt,
    framerule=0pt,
    rulecolor=\color{codebg},
    xleftmargin=3pt,
    xrightmargin=3pt,
    aboveskip=8pt,
    belowskip=8pt,
    tabsize=2,
    captionpos=b,
    numbers=none,
    breakindent=15pt,
    postbreak=\mbox{\textcolor{codeoperator}{$\hookrightarrow$}\space},
    columns=flexible,
    keepspaces=true,
    extendedchars=true,
    inputencoding=utf8,
    escapeinside={(*@}{@*)},
    linewidth=\textwidth,
    resetmargins=true
}

% Enhanced code formatting for better line wrapping
\usepackage{fancyvrb}
\fvset{
    fontsize=\scriptsize,
    breaklines=true,
    breakanywhere=true,
    breakautoindent=true,
    breakindent=15pt,
    xleftmargin=3pt,
    xrightmargin=3pt,
    frame=single,
    framesep=3pt,
    rulecolor=\color{codebg},
    fillcolor=\color{codebg},
    formatcom=\color{codetext}
}

% Table formatting
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}

% Links and references
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue!70!black,
    filecolor=blue!70!black,
    urlcolor=blue!70!black,
    citecolor=blue!70!black,
    pdfborder={0 0 0},
    breaklinks=true
}

% Graphics and images
\usepackage{graphicx}
\usepackage{grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% Additional packages
\usepackage{parskip}
\usepackage{xltxtra,xunicode}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{unicode-math}
\usepackage{fontspec}

% Set fonts with better code font
\defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
\setmainfont{DejaVu Serif}
\setmonofont[Scale=0.85]{DejaVu Sans Mono}

% Tighter list spacing
\usepackage{enumitem}
\setlist{itemsep=0pt, parsep=0pt}

% Better paragraph formatting
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}

% Improve page breaks
\usepackage{needspace}
\usepackage{afterpage}

% Custom commands
\newcommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Better handling of long URLs and file paths
\usepackage{url}
\urlstyle{same}

% Code block styling for Pandoc with improved wrapping
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{
    commandchars=\\\{\},
    fontsize=\scriptsize,
    backgroundcolor=\color{codebg},
    formatcom=\color{codetext},
    breaklines=true,
    breakanywhere=true,
    breakautoindent=true,
    breakindent=15pt,
    xleftmargin=3pt,
    xrightmargin=3pt,
    frame=single,
    framesep=3pt,
    rulecolor=\color{codebg}
}

% Syntax highlighting colors (VS Code Dark theme)
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{\textbf{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.42,0.58,0.66}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.58,0.58,0.98}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.71,0.82,0.66}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.34,0.61,0.84}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.81,0.57,0.47}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.42,0.58,0.33}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.42,0.58,0.33}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.34,0.61,0.84}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.70,0.44,0.82}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.34,0.61,0.84}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.71,0.82,0.66}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.42,0.58,0.33}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.71,0.82,0.66}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.86,0.86,0.40}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.34,0.61,0.84}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.42,0.58,0.33}{\textit{#1}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.34,0.61,0.84}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.83,0.83,0.83}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.83,0.83,0.83}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.34,0.61,0.84}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.70,0.44,0.82}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.57,0.47}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.81,0.57,0.47}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.81,0.57,0.47}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.50,0.80,0.93}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.81,0.57,0.47}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{\textbf{\textit{#1}}}}

% Prevent page breaks in code blocks when possible
\usepackage{etoolbox}
\BeforeBeginEnvironment{Highlighting}{\begin{samepage}}
\AfterEndEnvironment{Highlighting}{\end{samepage}}

% Better line breaking and hyphenation
\usepackage{microtype}
\DisableLigatures{encoding = *, family = tt* }

% Widow and orphan control
\widowpenalty=10000
\clubpenalty=10000

% Allow more flexible line breaking in code
\usepackage{xparse}
\ExplSyntaxOn
\NewDocumentCommand{\flexiblebreak}{}{%
  \discretionary{}{\hbox{$\hookrightarrow$}}{}%
}
\ExplSyntaxOff

% Improve code block spacing
\setlength{\fboxsep}{5pt}
\setlength{\fboxrule}{0pt}
